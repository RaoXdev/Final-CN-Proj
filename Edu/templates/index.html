{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Educational Resource Finder</title>

    <script
            src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap" loading="async"
            defer>
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="{% static 'css/nearby_search_styles.css' %}">

    <script src="{% static 'js/searchHandlers.js' %}"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top bg-white navbar-light shadow-sm">
    <div class="container-fluid">
        <!-- Logo -->
        <a class="navbar-brand fw-bold" href="#">Educational Resource Finder</a>

        <!-- Toggler for mobile view -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar content -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <!-- Left nav links -->
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">About Us</a>
                </li>
            </ul>

            <!-- Right-side tools -->
            <div class="d-flex align-items-center gap-3 flex-wrap">
                <!-- Search bar -->
                <div id="search-container">
                    <div class="input-group">
                        <input type="text" id="location-search" class="form-control"
                               placeholder="Search for a location"/>
                        <button class="btn btn-primary" id="search-button">Search</button>
                    </div>
                </div>

                <!-- Profile/Login buttons -->
                <div>
                    {% if user.is_authenticated %}
                        <button type="button" class="btn profile-btn"
                                onclick="toggleProfileModal()">
                            <img src="/static/images/default-avatar.png"
                                 alt="Profile Avatar" class="profile-avatar"/>
                        </button>
                    {% else %}
                        <button type="button" class="btn btn-primary"
                                onclick="window.location.href='{% url 'login_register' %}'">Login/Register
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- Modal for Profile -->
<div id="profile-modal" class="profile-modal d-none">
    <div class="modal-overlay"></div>
    <div class="modal-content p-0 overflow-hidden">
        <div class="modal-header px-4 py-3">
            <h5 class="modal-title">User Profile</h5>
            <button type="button" class="btn-close" id="close-modal-btn"></button>
        </div>
        <div class="modal-body p-0">
            <div class="card user-card-full m-0 border-0">
                <div class="row m-l-0 m-r-0 no-gutters">
                    <div class="col-sm-4 bg-c-lite-green user-profile">
                        <div class="card-block text-center text-white">
                            <div class="m-b-25">
                                <img src="https://img.icons8.com/bubbles/100/000000/user.png" class="img-radius"
                                     alt="User-Profile-Image">
                            </div>
                            <h6 class="f-w-600">{{ user.first_name }} {{ user.last_name }}</h6>
                            <p>{{ user.role }}</p>
                        </div>
                    </div>
                    <div class="col-sm-8">
                        <div class="card-block">
                            <h6 class="m-b-20 p-b-5 b-b-default f-w-600">Information</h6>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p class="m-b-10 f-w-600">Email</p>
                                    <h6 class="text-muted f-w-400">{{ user.email }}</h6>
                                </div>
                                <div class="col-sm-6">
                                    <p class="m-b-10 f-w-600">Phone</p>
                                    <h6 class="text-muted f-w-400">{{ user.phone }}</h6>
                                </div>
                            </div>
                            <h6 class="m-b-20 m-t-40 p-b-5 b-b-default f-w-600">Projects</h6>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p class="m-b-10 f-w-600">Recent</p>
                                    <h6 class="text-muted f-w-400">{{ user.recent_project }}</h6>
                                </div>
                                <div class="col-sm-6">
                                    <p class="m-b-10 f-w-600">Most Viewed</p>
                                    <h6 class="text-muted f-w-400">{{ user.popular_project }}</h6>
                                </div>
                            </div>
                            <ul class="social-link list-unstyled m-t-40 m-b-10">
                                <li><a href="#"><i class="mdi mdi-facebook feather icon-facebook facebook"
                                                   aria-hidden="true"></i></a></li>
                                <li><a href="#"><i class="mdi mdi-twitter feather icon-twitter twitter"
                                                   aria-hidden="true"></i></a></li>
                                <li><a href="#"><i class="mdi mdi-instagram feather icon-instagram instagram"
                                                   aria-hidden="true"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer px-4 py-3">
            <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger">Logout</button>
            </form>
        </div>
    </div>
</div>


<div class="main-container">
    <div class="left-panel">
        <div id="map"></div>
    </div>
    <div class="place-info gap-3">
        <div id="filter-container" class="d-flex align-items-center gap-4 p-3 bg-light rounded shadow-sm">
            <!-- Filter Categories Dropdown -->
            <div class="form-group w-100">
                <label for="filter-dropdown" class="form-label text-secondary">Filter Categories</label>
                <div class="dropdown">
                    <button id="filter-dropdown" class="btn btn-outline-primary dropdown-toggle w-100" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                        Select Categories
                    </button>
                    <ul class="dropdown-menu p-3 w-100" style="min-width: 250px;">
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="library-filter" checked/>
                                <label class="form-check-label" for="library-filter">Libraries</label>
                            </div>
                        </li>
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="universities-filter" checked/>
                                <label class="form-check-label" for="universities-filter">University</label>
                            </div>
                        </li>
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="schools-filter" checked/>
                                <label class="form-check-label" for="schools-filter">Schools</label>
                            </div>
                        </li>
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="event-filter" checked/>
                                <label class="form-check-label" for="event-filter">Events</label>
                            </div>
                        </li>
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="bookstores-filter" checked/>
                                <label class="form-check-label" for="bookstores-filter">Books Store</label>
                            </div>
                        </li>
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="primary-schools-filter" checked/>
                                <label class="form-check-label" for="primary-schools-filter">Primary Schools</label>
                            </div>
                        </li>
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="secondary-schools-filter" checked/>
                                <label class="form-check-label" for="secondary-schools-filter">Secondary Schools</label>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Radius Selector -->
            <div class="radius-selector form-group w-100">
                <label for="radius-select" class="form-label text-secondary">Select Radius</label>
                <div class="d-flex align-items-center justify-content-between">
                    <input type="range" class="form-range mr-auto" id="radius-select" min="1500" max="15000" step="500"
                           value="5000">
                    <span id="radius-value" class="p-2 badge">5km</span>
                </div>
            </div>

        </div>
        <div class="right-sidebar">
            <ul class="nav nav-tabs " id="resourceTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="libraries-tab" data-bs-toggle="tab" data-bs-target="#libraries"
                            type="button" role="tab" aria-controls="libraries" aria-selected="true">Libraries
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button"
                            role="tab" aria-controls="events" aria-selected="false">Events
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link " id="schools-tab" data-bs-toggle="tab" data-bs-target="#schools"
                            type="button" role="tab" aria-controls="schools" aria-selected="true">Schools
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="universities-tab" data-bs-toggle="tab" data-bs-target="#universities"
                            type="button"
                            role="tab" aria-controls="universities" aria-selected="false">Universities
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="bookstores-tab" data-bs-toggle="tab" data-bs-target="#book-stores"
                            type="button"
                            role="tab" aria-controls="book-stores" aria-selected="false">Book Stores
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link " id="primary-schools-tab" data-bs-toggle="tab"
                            data-bs-target="#primary-schools"
                            type="button" role="tab" aria-controls="primary-schools" aria-selected="true">Primary
                        Schools
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="secondary-schools-tab" data-bs-toggle="tab"
                            data-bs-target="#secondary-schools"
                            type="button"
                            role="tab" aria-controls="secondary-schools" aria-selected="false">Secondary Schools
                    </button>
                </li>
            </ul>

            <div class="tab-content pt-3" id="resourceTabsContent">
                <div class="tab-pane fade show active" id="libraries" role="tabpanel" aria-labelledby="libraries-tab">
                    <div id="libraries-list">Loading...</div>
                </div>
                <div class="tab-pane fade show" id="events" role="tabpanel" aria-labelledby="events-tab">
                    <div id="events-list">Loading...</div>
                </div>
                <div class="tab-pane fade show" id="universities" role="tabpanel" aria-labelledby="universities-tab">
                    <div id="universities-list">Loading...</div>
                </div>
                <div class="tab-pane fade show " id="schools" role="tabpanel" aria-labelledby="schools-tab">
                    <div id="schools-list">Loading...</div>
                </div>
                <div class="tab-pane fade show" id="book-stores" role="tabpanel" aria-labelledby="book-stores-tab">
                    <div id="book-stores-list">Loading...</div>
                </div>
                <div class="tab-pane fade show" id="primary-schools" role="tabpanel"
                     aria-labelledby="primary-schools-tab">
                    <div id="primary-schools-list">Loading...</div>
                </div>
                <div class="tab-pane fade show " id="secondary-schools" role="tabpanel"
                     aria-labelledby="secondary-schools-tab">
                    <div id="secondary-schools-list">Loading...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="loading-spinner" style="display: none; text-align: center; margin-top: 1rem;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>
<div id="book-covers-container" class="row mt-4"></div>

<script src="{% static 'js/script.js' %}"></script>

<script>
    // Get the slider and value display elements
    {#const radiusSelect = document.getElementById('radius-select');#}
    const radiusValue = document.getElementById('radius-value');

    // Function to update the radius value text
    function updateRadiusText() {
        const radiusInKm = radiusSelect.value / 1000; // Convert meters to kilometers
        radiusValue.textContent = `${radiusInKm}km`; // Update the text content
    }

    // Add event listener for input event
    radiusSelect.addEventListener('input', updateRadiusText);

    // Initialize the text on page load
    updateRadiusText();

    // Function to toggle the profile modal
    function toggleProfileModal() {
        const modal = document.getElementById('profile-modal');
        modal.classList.toggle('d-none');
    }

    document.addEventListener('DOMContentLoaded', () => {
        const overlay = document.querySelector('.modal-overlay');
        const closeModalBtn = document.getElementById('close-modal-btn');

        if (overlay) {
            overlay.addEventListener('click', toggleProfileModal);
        }

        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', toggleProfileModal);
        }
    });

</script>
</body>
</html>